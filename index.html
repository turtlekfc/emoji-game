<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji æ¶ç­”å¤§è³½</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #6c5ce7; --accent: #fdcb6e; --danger: #ff7675; --success: #55efc4; }
        
        body { 
            font-family: 'PingFang TC', 'Microsoft JhengHei', cursive, sans-serif; 
            background: radial-gradient(circle, #6c5ce7 0%, #4834d4 100%);
            color: white; margin: 0; padding-top: 20px; 
            display: flex; flex-direction: column; align-items: center; min-height: 100vh; 
        }

        /* 1. æ´»æ½‘å¯æ„›æ¨™é¡Œ */
        .event-title { 
            font-size: 3rem; font-weight: 900; 
            color: var(--accent); 
            text-shadow: 4px 4px 0px #d35400, 8px 8px 20px rgba(0,0,0,0.3);
            margin: 20px 0; letter-spacing: 4px;
            animation: titleFloat 2s ease-in-out infinite;
        }
        @keyframes titleFloat {
            0%, 100% { transform: translateY(0) rotate(-2deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
        }

        .card { 
            background: white; color: #2d3436; padding: 30px; 
            border-radius: 30px; width: 90%; max-width: 500px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.3); 
            border: 8px solid rgba(255,255,255,0.2);
        }

        .hidden { display: none !important; }

        /* éŠæˆ²ç®±å­ */
        .emoji-box { 
            font-size: 90px; margin: 20px 0; min-height: 150px; 
            display: flex; justify-content: center; align-items: center; 
            background: #f1f2f6; border-radius: 20px;
            box-shadow: inset 0 5px 10px rgba(0,0,0,0.1);
        }

        input { 
            padding: 15px; font-size: 1.2rem; width: 85%; 
            margin: 10px 0; border: 3px solid #dfe6e9; border-radius: 15px;
            text-align: center;
        }

        button { 
            background: var(--accent); color: #d35400; border: none; 
            padding: 15px 30px; font-size: 1.3rem; border-radius: 50px; 
            cursor: pointer; font-weight: 900; box-shadow: 0 5px 0 #e67e22;
            transition: 0.1s; margin: 10px;
        }
        button:active { transform: translateY(3px); box-shadow: 0 2px 0 #e67e22; }

        /* 2. ä¸»æŒäººå°ˆç”¨é‡ç½®æŒ‰éˆ•æ¨£å¼ */
        .host-reset-bar {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px; border-radius: 50px;
            margin-bottom: 20px; display: flex; align-items: center; gap: 15px;
        }
        .btn-mini-reset { 
            background: var(--danger); color: white; padding: 5px 15px; 
            font-size: 0.9rem; box-shadow: 0 3px 0 #c0392b; 
        }

        .announcement { 
            background: var(--success); color: #006266; padding: 15px; 
            border-radius: 15px; margin: 15px 0; font-weight: bold; font-size: 1.2rem;
            border: 2px dashed #009432;
        }

        .lb-item { 
            display: flex; justify-content: space-between; padding: 12px; 
            border-bottom: 2px solid #f1f2f6; font-size: 1.3rem; font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="event-title">æ´»å‹•åç¨±</div>

    <div id="host-global-tools" class="host-reset-bar hidden">
        <span>ğŸ‘‘ ç®¡ç†å“¡æ¨¡å¼</span>
        <button onclick="hardResetGame()" class="btn-mini-reset">ğŸ”„ é‡ç½®æ•´å€‹éŠæˆ²</button>
    </div>

    <div class="card">
        <div id="view-login">
            <h2 style="color: var(--primary);">æº–å‚™å¥½æ¶ç­”äº†å—ï¼Ÿ</h2>
            <input type="text" id="username" placeholder="è¼¸å…¥ä½ çš„å¤§å">
            <button id="btn-join">GO! é€²å…¥éŠæˆ²</button>
        </div>

        <div id="view-waiting" class="hidden">
            <h3>å“ˆå›‰ <span id="display-name" style="color:var(--primary);"></span></h3>
            <p>å¤§å®¶åå¥½ï¼Œæº–å‚™è¦é–‹å§‹å›‰ï¼</p>
            <div id="host-ctrl" class="hidden">
                <button id="btn-start" style="background:#55efc4; color:#006266; box-shadow:0 5px 0 #009432;">ğŸš€ å•Ÿå‹•éŠæˆ²</button>
            </div>
        </div>

        <div id="view-game" class="hidden">
            <div id="q-header" style="font-weight: bold; font-size: 1.1rem;">æ­£åœ¨å‡ºé¡Œ...</div>
            <div id="q-emoji" class="emoji-box"></div>
            
            <div id="player-zone" class="hidden">
                <input type="text" id="ans-input" placeholder="ç­”æ¡ˆæ˜¯ä»€éº¼ï¼Ÿ">
                <button id="btn-submit">æˆ‘å…ˆæ¶ç­”ï¼</button>
                <p id="feedback" style="color:var(--danger); font-weight:bold;"></p>
            </div>

            <div id="win-notification" class="hidden">
                <div class="announcement">ğŸŠ å¤ªå²å®³äº†ï¼<br><span id="win-player-name"></span> ç­”å°äº†ï¼</div>
            </div>

            <div id="ans-reveal" class="hidden" style="background:#e1f5fe; padding:15px; border-radius:20px;">
                <h3 style="margin:0;">æ­£è§£ï¼š<span id="correct-ans" style="color:#0288d1;"></span></h3>
            </div>

            <div id="host-actions" class="hidden">
                <button id="btn-reveal" style="background:var(--accent);">ğŸ‘€ æ­æ›‰ç­”æ¡ˆ</button>
                <button id="btn-next" class="hidden" style="background:var(--primary); color:white; box-shadow: 0 5px 0 #4834d4;">ä¸‹ä¸€é¡Œ â”</button>
            </div>
        </div>

        <div id="view-result" class="hidden">
            <h2 style="color:var(--primary);">ğŸ† æ¦®è­½æ¦œ</h2>
            <div id="leaderboard"></div>
            <button onclick="location.reload()" style="background:#dfe6e9; color:#636e72; box-shadow:0 5px 0 #b2bec3;">å›é¦–é </button>
        </div>
    </div>

    <script>
        const config = {
            apiKey: "AIzaSyAGKM7UL7hYCijHzS7lbPuHi-2M8Y9gZ7U",
            authDomain: "kahootclone-94620.firebaseapp.com",
            databaseURL: "https://kahootclone-94620-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "kahootclone-94620",
            storageBucket: "kahootclone-94620.appspot.com",
            messagingSenderId: "173514871128",
            appId: "1:173514871128:web:6ca8ccb012ba5a49b7d52d"
        };

        firebase.initializeApp(config);
        const db = firebase.database();
        const isHost = window.location.search.includes('host=true');
        let myName = "";

        const questions = [
            { emoji: "ğŸ² â™¨ï¸", answer: "é¾æ½­" }, { emoji: "5ï¸âƒ£â›°ï¸", answer: "äº”å³°" }, { emoji: "ğŸ”Ÿ0ï¸âƒ£0ï¸âƒ£0ï¸âƒ£ğŸŒ¸", answer: "è¬è¯" },
            { emoji: "ğŸª‘æ©‹", answer: "æ¿æ©‹" }, { emoji: "ğŸ†•ğŸ ", answer: "æ–°å±‹" }, { emoji: "ğŸ†•ğŸ›’", answer: "æ–°åº—" },
            { emoji: "3ï¸âƒ£â›°ï¸", answer: "ä¸‰å³½" }, { emoji: "ğŸ¥‡â›°ï¸", answer: "é‡‘å±±" }, { emoji: "5ï¸âƒ£ğŸ¦´", answer: "äº”è‚¡" },
            { emoji: "7ï¸âƒ£ğŸš§", answer: "ä¸ƒå µ" }, { emoji: "ğŸ’â›°ï¸", answer: "å¯¶å±±" }, { emoji: "ğŸ¦ â™¨ï¸", answer: "ç…æ½­" },
            { emoji: "â¬‡ï¸âš“", answer: "å—æ¸¯" }, { emoji: "ğŸ˜ğŸ¤°", answer: "å¤§è‚š" }, { emoji: "é¹¿ğŸ¦Œâš“", answer: "é¹¿æ¸¯" },
            { emoji: "2ï¸âƒ£ğŸŒ²", answer: "äºŒæ—" }, { emoji: "2ï¸âƒ£ğŸ’§", answer: "äºŒæ°´" }, { emoji: "ğŸ‹â›°ï¸", answer: "ç«¹å±±" },
            { emoji: "4ï¸âƒ£â™¨ï¸", answer: "å››æ¹–" }, { emoji: "ğŸ˜ğŸŒ²", answer: "å¤§æ—" }, { emoji: "ğŸ†•âš“", answer: "æ–°æ¸¯" },
            { emoji: "6ï¸âƒ£ğŸ¦µ", answer: "å…­è…³" }, { emoji: "ğŸ¦ŒğŸŒ±", answer: "é¹¿è‰" }, { emoji: "ğŸ§‚ğŸ’§", answer: "é¹½æ°´" },
            { emoji: "3ï¸âƒ£ğŸ§‘â€ğŸ¤â€ğŸ§‘", answer: "ä¸‰æ°‘" }, { emoji: "ğŸš©â›°ï¸", answer: "æ——å±±" }, { emoji: "6ï¸âƒ£ğŸ¢", answer: "å…­é¾œ" },
            { emoji: "â¡ï¸âš“", answer: "æ±æ¸¯" }, { emoji: "â™¾ï¸ğŸŒ¸", answer: "æ†æ˜¥" }, { emoji: "ğŸ¦", answer: "ç…å­" },
            { emoji: "ğŸŒº", answer: "ç‰¡ä¸¹" }, { emoji: "3ï¸âƒ£â­", answer: "ä¸‰æ˜Ÿ" }, { emoji: "ğŸ˜âš”ï¸", answer: "å¤§æ­¦" },
            { emoji: "7ï¸âƒ£ ğŸ§œ", answer: "ä¸ƒç¾" }
        ];

        function goTo(id) {
            document.querySelectorAll('.card > div').forEach(el => el.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        // 2. å…¨å±€é‡ç½®åŠŸèƒ½ï¼šæ¸…ç©ºæ‰€æœ‰åˆ†æ•¸èˆ‡éŠæˆ²ç‹€æ…‹
        function hardResetGame() {
            if(confirm("âš  æ³¨æ„ï¼šé€™æœƒåˆªé™¤æ‰€æœ‰ç©å®¶åˆ†æ•¸ä¸¦é‡æ–°é–‹å§‹ï¼ç¢ºå®šå—ï¼Ÿ")) {
                db.ref('/').remove().then(() => {
                    window.location.href = window.location.pathname + (isHost ? "?host=true" : "");
                });
            }
        }

        document.getElementById('btn-join').onclick = function() {
            myName = document.getElementById('username').value.trim();
            if(!myName) return alert("è«‹è¼¸å…¥åå­—");
            document.getElementById('display-name').innerText = myName;
            goTo('view-waiting');
            if(isHost) {
                document.getElementById('host-global-tools').classList.remove('hidden');
                document.getElementById('host-ctrl').classList.remove('hidden');
            }
        };

        document.getElementById('btn-start').onclick = function() {
            const shuffled = questions.sort(() => 0.5 - Math.random()).slice(0, 10);
            db.ref('game').set({ status: 'playing', qs: shuffled, idx: 0, winner: "", show: false });
        };

        db.ref('game').on('value', (snap) => {
            const game = snap.val();
            if(!game) {
                if(myName) goTo('view-waiting');
                return;
            }
            if(game.status === 'playing') {
                goTo('view-game');
                const cur = game.qs[game.idx];
                document.getElementById('q-emoji').innerText = cur.emoji;
                document.getElementById('q-header').innerText = "ç¬¬ " + (game.idx + 1) + " é¡Œ";

                if(game.winner) {
                    document.getElementById('player-zone').classList.add('hidden');
                    document.getElementById('win-notification').classList.remove('hidden');
                    document.getElementById('win-player-name').innerText = game.winner;
                    if(isHost) {
                        document.getElementById('host-actions').classList.remove('hidden');
                        document.getElementById('btn-next').classList.toggle('hidden', !game.show);
                    }
                    if(game.show) {
                        document.getElementById('ans-reveal').classList.remove('hidden');
                        document.getElementById('correct-ans').innerText = cur.answer;
                    }
                } else {
                    if(!isHost) document.getElementById('player-zone').classList.remove('hidden');
                    document.getElementById('win-notification').classList.add('hidden');
                    document.getElementById('ans-reveal').classList.add('hidden');
                    document.getElementById('host-actions').classList.add('hidden');
                    document.getElementById('ans-input').value = "";
                    document.getElementById('feedback').innerText = "";
                }
            } else if(game.status === 'finished') {
                goTo('view-result');
                db.ref('players').once('value', pSnap => {
                    const ps = pSnap.val();
                    let list = [];
                    for(let k in ps) list.push({n: k, s: ps[k]});
                    list.sort((a,b) => b.s - a.s);
                    document.getElementById('leaderboard').innerHTML = list.map(p => 
                        `<div class="lb-item"><span>${p.n}</span><span>${p.s} åˆ†</span></div>`
                    ).join('');
                });
            }
        });

        document.getElementById('btn-submit').onclick = function() {
            const val = document.getElementById('ans-input').value.trim();
            db.ref('game').once('value', (snap) => {
                const g = snap.val();
                if(val === g.qs[g.idx].answer && !g.winner) {
                    db.ref('game/winner').set(myName);
                    db.ref('players/' + myName).transaction(s => (s || 0) + 10);
                } else if(val) {
                    document.getElementById('feedback').innerText = "âŒ ç­”éŒ¯äº†ï¼Œå†æƒ³æƒ³ï¼";
                }
            });
        };

        document.getElementById('btn-reveal').onclick = () => db.ref('game/show').set(true);
        document.getElementById('btn-next').onclick = () => {
            db.ref('game').once('value', snap => {
                const g = snap.val();
                if(g.idx + 1 < g.qs.length) {
                    db.ref('game').update({idx: g.idx + 1, winner: "", show: false});
                } else {
                    db.ref('game/status').set('finished');
                }
            });
        };
    </script>
</body>
</html>