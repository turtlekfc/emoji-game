<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Emoji æ¶ç­”æ­£å¼ç‰ˆ</title>

<style>
:root { --p:#46178f; --a:#ffa600; }
body{
    font-family:sans-serif;
    background:var(--p);
    color:white;
    margin:0;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    text-align:center;
}
.card{
    background:white;
    color:#333;
    padding:25px;
    border-radius:15px;
    width:90%;
    max-width:500px;
}
.hidden{ display:none !important; }
.emoji-box{
    font-size:70px;
    margin:20px 0;
    min-height:100px;
    line-height:100px;
}
input{
    padding:12px;
    width:80%;
    margin:10px 0;
    border:2px solid #ddd;
    border-radius:8px;
}
button{
    background:var(--a);
    color:white;
    border:none;
    padding:12px 25px;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
}
</style>
</head>

<body>

<div id="debug-info" style="position:fixed;top:0;font-size:10px;color:#aaa;">Loading...</div>

<div class="card">

<!-- LOGIN -->
<div id="view-login">
    <h2>ğŸ‘€ Emoji è«§éŸ³å¤§è³½</h2>
    <input id="username" placeholder="è¼¸å…¥å§“å">
    <button id="btn-join">åŠ å…¥</button>
</div>

<!-- WAIT -->
<div id="view-wait" class="hidden">
    <h3>æ‚¨å¥½ <span id="display-name"></span></h3>
    <p>ç­‰å¾…ä¸»æŒäººé–‹å§‹â€¦</p>
    <div id="host-ctrl" class="hidden">
        <button id="btn-start">é–‹å§‹éŠæˆ²</button>
    </div>
</div>

<!-- GAME -->
<div id="view-game" class="hidden">
    <div id="q-info"></div>
    <div id="q-emoji" class="emoji-box"></div>

    <div id="player-zone">
        <input id="ans-input" placeholder="ç­”æ¡ˆï¼Ÿ">
        <button id="btn-submit">é€å‡º</button>
        <p id="msg" style="color:red;"></p>
    </div>

    <div id="ans-reveal" class="hidden">
        <h2 id="correct-ans" style="color:blue;"></h2>
        <p id="winner-name"></p>
    </div>

    <div id="host-actions" class="hidden">
        <button id="btn-reveal">æ­æ›‰</button>
        <button id="btn-next" class="hidden">ä¸‹ä¸€é¡Œ</button>
    </div>
</div>

<!-- RESULT -->
<div id="view-result" class="hidden">
    <h2>ğŸ† æœ€çµ‚æ’è¡Œ</h2>
    <div id="leaderboard"></div>
    <button onclick="location.reload()">é‡ç©</button>
</div>

</div>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
document.getElementById("debug-info").innerText="JS Loaded";

const firebaseConfig={
 apiKey:"AIzaSyAGKM7UL7hYCijHzS7lbPuHi-2M8Y9gZ7U",
 authDomain:"kahootclone-94620.firebaseapp.com",
 databaseURL:"https://kahootclone-94620-default-rtdb.asia-southeast1.firebasedatabase.app",
 projectId:"kahootclone-94620",
 storageBucket:"kahootclone-94620.appspot.com",
 messagingSenderId:"173514871128",
 appId:"1:173514871128:web:6ca8ccb012ba5a49b7d52d"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();

const isHost=new URLSearchParams(location.search).get("host")==="true";
let myName="";

document.getElementById("debug-info").innerText="Firebase Ready | "+(isHost?"HOST":"PLAYER");

const questions=[
 {emoji:"ğŸ²â™¨ï¸",answer:"é¾æ½­"},
 {emoji:"5ï¸âƒ£â›°ï¸",answer:"äº”å³°"},
 {emoji:"ğŸª‘æ©‹",answer:"æ¿æ©‹"},
 {emoji:"ğŸ†•ğŸ›’",answer:"æ–°åº—"},
 {emoji:"3ï¸âƒ£â›°ï¸",answer:"ä¸‰å³½"},
 {emoji:"ğŸ¥‡â›°ï¸",answer:"é‡‘å±±"},
 {emoji:"5ï¸âƒ£ğŸ¦´",answer:"äº”è‚¡"},
 {emoji:"7ï¸âƒ£ğŸš§",answer:"ä¸ƒå µ"},
 {emoji:"ğŸ’â›°ï¸",answer:"å¯¶å±±"},
 {emoji:"ğŸ¦Œâš“",answer:"é¹¿æ¸¯"}
];

function go(id){
 document.querySelectorAll(".card>div").forEach(d=>d.classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
}

btnJoin.onclick=()=>{
 myName=username.value.trim();
 if(!myName) return alert("è«‹è¼¸å…¥å§“å");
 display-name.innerText=myName;
 go("view-wait");
 if(isHost){
  host-ctrl.classList.remove("hidden");
  db.ref("game").remove();
 }
};

btn-start.onclick=()=>{
 const qs=[...questions].sort(()=>0.5-Math.random());
 db.ref("game").set({
  status:"playing",
  qs:qs,
  idx:0,
  winner:"",
  show:false
 });
};

db.ref("game").on("value",snap=>{
 const g=snap.val();
 if(!g) return;

 if(g.status==="playing"){
  go("view-game");
  const q=g.qs[g.idx];
  q-info.innerText=`ç¬¬ ${g.idx+1} é¡Œ`;
  q-emoji.innerText=q.emoji;

  if(g.winner){
   player-zone.classList.add("hidden");
   if(isHost){
    host-actions.classList.remove("hidden");
    btn-next.classList.toggle("hidden",!g.show);
   }
   if(g.show){
    ans-reveal.classList.remove("hidden");
    correct-ans.innerText="ç­”æ¡ˆï¼š"+q.answer;
    winner-name.innerText="è´å®¶ï¼š"+g.winner;
   }
  }else{
   player-zone.classList.remove("hidden");
   ans-reveal.classList.add("hidden");
   host-actions.classList.add("hidden");
  }
 }

 if(g.status==="finished"){
  go("view-result");
  db.ref("players").once("value",s=>{
   const ps=s.val()||{};
   leaderboard.innerHTML=Object.keys(ps)
    .sort((a,b)=>ps[b]-ps[a])
    .map(n=>`<div>${n}: ${ps[n]}</div>`).join("");
  });
 }
});

btn-submit.onclick=()=>{
 const ans=ans-input.value.trim();
 db.ref("game").once("value",snap=>{
  const g=snap.val();
  if(ans===g.qs[g.idx].answer && !g.winner){
   db.ref("game").update({winner:myName});
   db.ref("players/"+myName).transaction(s=>(s||0)+10);
  }else{
   msg.innerText="å†è©¦è©¦ï¼";
  }
 });
};

btn-reveal.onclick=()=>db.ref("game").update({show:true});
btn-next.onclick=()=>{
 db.ref("game").once("value",snap=>{
  const g=snap.val();
  if(g.idx+1<g.qs.length){
   db.ref("game").update({idx:g.idx+1,winner:"",show:false});
  }else{
   db.ref("game").update({status:"finished"});
  }
 });
};
</script>
</body>
</html>
